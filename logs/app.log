import os

directory = 'contracts'
os.system("rm -r smt-generated/*")
# os.system("rm -r logs")
for filename in os.listdir(directory):
    if (filename.endswith('json')):
        cmd = "java -jar ethor.jar --smt-out-dir=. --no-output-query-results --preanalysis --prune-strategy={} --predicate-inlining-strategy=linear contracts/{}"
        strategy = "aggressive"
        os.system(cmd.format(strategy, filename))
    file = open("logs/app.log", "r")
    Lines = file.readlines()
    error_string = "Do not execute z3 queries"
    flag = True
    for line in Lines:
        if line.find(error_string) != -1:
            flag = False
    if (flag):
        os.system("z3 {}.smt > result/{}.txt".format(filename, filename[:-5]))
    os.system("mv {}.smt smt-generated/".format(filename))
    os.system("rm -r logs")
